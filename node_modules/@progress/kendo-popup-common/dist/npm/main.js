'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var alignPoint = {
    "bottom": "bottom",
    "center": "center",
    "middle": "middle",
    "left": "left",
    "right": "right",
    "top": "top"
};

var align = function (options) {
    var anchorRect = options.anchorRect;
    var anchorAlign = options.anchorAlign;
    var elementRect = options.elementRect;
    var elementAlign = options.elementAlign;
    var margin = options.margin; if ( margin === void 0 ) margin = {};
    var anchorHorizontal = anchorAlign.horizontal;
    var anchorVertical = anchorAlign.vertical;
    var elementHorizontal = elementAlign.horizontal;
    var elementVertical = elementAlign.vertical;

    var horizontalMargin = margin.horizontal || 0;
    var verticalMargin = margin.vertical || 0;

    var top = anchorRect.top;
    var left = anchorRect.left;

    if (anchorVertical === alignPoint.bottom) {
        top += anchorRect.height;
    }

    if (anchorVertical === alignPoint.center || anchorVertical === alignPoint.middle) {
        top += Math.round(anchorRect.height / 2);
    }

    if (elementVertical === alignPoint.bottom) {
        top -= elementRect.height;
        verticalMargin *= -1;
    }

    if (elementVertical === alignPoint.center || elementVertical === alignPoint.middle) {
        top -= Math.round(elementRect.height / 2);
        verticalMargin *= -1;
    }

    if (anchorHorizontal === alignPoint.right) {
        left += anchorRect.width;
    }

    if (anchorHorizontal === alignPoint.center || anchorHorizontal === alignPoint.middle) {
        left += Math.round(anchorRect.width / 2);
    }

    if (elementHorizontal === alignPoint.right) {
        left -= elementRect.width;
        horizontalMargin *= -1;
    }

    if (elementHorizontal === alignPoint.center || elementHorizontal === alignPoint.middle) {
        left -= Math.round(elementRect.width / 2);
        horizontalMargin *= -1;
    }

    return {
        top: top + verticalMargin,
        left: left + horizontalMargin
    };
};

function addScroll(rect, scroll) {
    return {
        top: rect.top + scroll.y,
        left: rect.left + scroll.x,
        height: rect.height,
        width: rect.width
    };
}

function applyLocationOffset(rect, location, isOffsetBody) {
    var top = rect.top;
    var left = rect.left;

    if (isOffsetBody) {
        left = 0;
        top = 0;
    }

    return {
        top: top + location.top,
        left: left + location.left,
        height: rect.height,
        width: rect.width
    };
}

function ownerDocument(element) {
    return element.ownerDocument || element.document || element;
}

var getWindow = function (element) { return ownerDocument(element).defaultView; };

var getDocument = function (element) { return ownerDocument(element).documentElement; };

var cachedWidth = 0;

function scrollbarWidth() {
    if (!cachedWidth && typeof document !== 'undefined') {
        var div = document.createElement("div");

        div.style.cssText = "overflow:scroll;overflow-x:hidden;zoom:1;clear:both;display:block";
        div.innerHTML = "&nbsp;";
        document.body.appendChild(div);

        cachedWidth = div.offsetWidth - div.scrollWidth;

        document.body.removeChild(div);
    }

    return cachedWidth;
}

function windowViewport(element) {
    var win = getWindow(element);
    var document = getDocument(element);
    var result = {
        height: win.innerHeight,
        width: win.innerWidth
    };

    if (document.scrollHeight - document.clientHeight > 0) {
        result.width -= scrollbarWidth();
    }

    return result;
}

var boundingOffset = function (element) {
    if (!element.getBoundingClientRect) {
        var viewport = windowViewport(element);
        return {
            bottom: viewport.height,
            left: 0,
            right: viewport.width,
            top: 0
        };
    }

    var ref = element.getBoundingClientRect();
    var bottom = ref.bottom;
    var left = ref.left;
    var right = ref.right;
    var top = ref.top;

    return {
        bottom: bottom,
        left: left,
        right: right,
        top: top
    };
};

var offsetParent = function (element) {
    var offsetParent = element.offsetParent;

    while (offsetParent && offsetParent.style.position === "static") {
        offsetParent = offsetParent.offsetParent;
    }

    return offsetParent || getDocument(element);
};

var isBodyOffset = function (element) { return (offsetParent(element) === element.ownerDocument.body); };

var rectOfHiddenElement = function (element) {
    var ref = element.style;
    var display = ref.display;
    var left = ref.left;
    var position = ref.position;

    element.style.display = '';
    element.style.left = '-10000px';
    element.style.position = 'absolute';

    var rect = element.getBoundingClientRect();

    element.style.display = display;
    element.style.left = left;
    element.style.position = position;

    return rect;
};

var offset = function (element) {
    var rect = element.getBoundingClientRect();
    var left = rect.left;
    var top = rect.top;

    if (!rect.height && !rect.width) {
        rect = rectOfHiddenElement(element);
    }

    return {
        top: top,
        left: left,
        height: rect.height,
        width: rect.width
    };
};

var parents = function (element, until) {
    var result = [];
    var next = element.parentNode;

    while (next) {
        result.push(next);

        if (next === until) { break; }

        next = next.parentNode;
    }

    return result;
};

function scrollPosition(element) {
    var documentElement = getDocument(element);
    var win = getWindow(element);

    return {
        x: win.pageXOffset || documentElement.scrollLeft || 0,
        y: win.pageYOffset || documentElement.scrollTop || 0
    };
}

var elementScrollPosition = function (element) {
    if (element === (element.ownerDocument || {}).body) {
        return scrollPosition(element);
    }

    return {
        x: element.scrollLeft,
        y: element.scrollTop
    };
};

function parentScrollPosition(element) {
    var parent = offsetParent(element);

    return parent ? elementScrollPosition(parent) : { x: 0, y: 0 };
}

var position = function (element, parent) {
    var win = getWindow(element);
    var elementStyles = win.getComputedStyle(element);
    var offset$$1 = offset(element);
    var parentElement = parent || offsetParent(element);

    var ownerDocument = element.ownerDocument;
    var useRelative = parentElement !== ownerDocument.body && parentElement !== ownerDocument.documentElement;

    var parentOffset = { top: 0, left: 0 };

    if (elementStyles.position !== "fixed" && useRelative) {
        var parentStyles = win.getComputedStyle(parentElement);

        parentOffset = offset(parentElement);
        parentOffset.top += parseInt(parentStyles.borderTopWidth, 10);
        parentOffset.left += parseInt(parentStyles.borderLeftWidth, 10);
    }

    return {
        top: offset$$1.top - parentOffset.top,
        left: offset$$1.left - parentOffset.left,
        height: offset$$1.height,
        width: offset$$1.width
    };
};

var offsetParentScrollPosition = function (offsetParentElement, element) { return ( // eslint-disable-line no-arrow-condition
    offsetParentElement ? elementScrollPosition(offsetParentElement) : parentScrollPosition(element)
); };

var positionWithScroll = function (element, parent) {
    var offsetParentElement = parent ? offsetParent(parent) : null;
    var ref = position(element, offsetParentElement);
    var top = ref.top;
    var left = ref.left;
    var height = ref.height;
    var width = ref.width;
    var ref$1 = offsetParentScrollPosition(offsetParentElement, element);
    var x = ref$1.x;
    var y = ref$1.y;

    return {
        top: top + y,
        left: left + x,
        height: height,
        width: width
    };
};

function removeScroll(rect, scroll) {
    return {
        top: rect.top - scroll.y,
        left: rect.left - scroll.x,
        height: rect.height,
        width: rect.width
    };
}

var collision = {
    "fit": "fit",
    "flip": "flip"
};

var fit = function(position, size, viewPortSize) {
    var output = 0;

    if (position + size > viewPortSize) {
        output = viewPortSize - (position + size);
    }

    if (position < 0) {
        output = -position;
    }

    return output;
};

var flip = function(ref) {
    var offset = ref.offset;
    var size = ref.size;
    var anchorSize = ref.anchorSize;
    var viewPortSize = ref.viewPortSize;
    var anchorAlignPoint = ref.anchorAlignPoint;
    var elementAlignPoint = ref.elementAlignPoint;
    var margin = ref.margin;

    var output = 0;

    var isPositionCentered = elementAlignPoint === alignPoint.center || elementAlignPoint === alignPoint.middle;
    var isOriginCentered = anchorAlignPoint === alignPoint.center || anchorAlignPoint === alignPoint.middle;
    var marginToAdd = 2 * margin; //2x to keep margin after flip

    if (elementAlignPoint !== anchorAlignPoint && !isPositionCentered && !isOriginCentered) {
        var isBeforeAnchor = anchorAlignPoint === alignPoint.top || anchorAlignPoint === alignPoint.left;
        if (offset < 0 && isBeforeAnchor) {
            output = size + anchorSize + marginToAdd;
            if (offset + output + size > viewPortSize) {
                output = 0; //skip flip
            }
        } else if (offset >= 0 && !isBeforeAnchor) {
            if (offset + size > viewPortSize) {
                output += -(anchorSize + size + marginToAdd);
            }

            if (offset + output < 0) {
                output = 0; //skip flip
            }
        }
    }

    return output;
};

var restrictToView = function (options) {
    var anchorRect = options.anchorRect;
    var anchorAlign = options.anchorAlign;
    var elementRect = options.elementRect;
    var elementAlign = options.elementAlign;
    var collisions = options.collisions;
    var viewPort = options.viewPort;
    var margin = options.margin; if ( margin === void 0 ) margin = {};
    var elementTop = elementRect.top;
    var elementLeft = elementRect.left;
    var elementHeight = elementRect.height;
    var elementWidth = elementRect.width;
    var viewPortHeight = viewPort.height;
    var viewPortWidth = viewPort.width;
    var horizontalMargin = margin.horizontal || 0;
    var verticalMargin = margin.vertical || 0;

    var left = 0;
    var top = 0;

    var isHorizontalFlip = collisions.horizontal === collision.flip;
    var isVerticalFlip = collisions.vertical === collision.flip;

    if (collisions.vertical === collision.fit) {
        top += fit(elementTop, elementHeight, viewPortHeight);
    }

    if (collisions.horizontal === collision.fit) {
        left += fit(elementLeft, elementWidth, viewPortWidth);
    }

    if (isVerticalFlip) {
        top += flip({
            margin: verticalMargin,
            offset: elementTop,
            size: elementHeight,
            anchorSize: anchorRect.height,
            viewPortSize: viewPortHeight,
            anchorAlignPoint: anchorAlign.vertical,
            elementAlignPoint: elementAlign.vertical
        });
    }

    if (isHorizontalFlip) {
        left += flip({
            margin: horizontalMargin,
            offset: elementLeft,
            size: elementWidth,
            anchorSize: anchorRect.width,
            viewPortSize: viewPortWidth,
            anchorAlignPoint: anchorAlign.horizontal,
            elementAlignPoint: elementAlign.horizontal
        });
    }
    var flippedHorizontal = isHorizontalFlip && left !== 0;
    var flippedVertical = isVerticalFlip && top !== 0;

    return {
        flipped: flippedHorizontal || flippedVertical,
        flip: {
            horizontal: flippedHorizontal,
            vertical: flippedVertical
        },
        offset: {
            left: left,
            top: top
        }
    };
};

var siblings = function (element) {
    var result = [];

    var sibling = element.parentNode.firstElementChild;

    while (sibling) {
        if (sibling !== element) {
            result.push(sibling);
        }

        sibling = sibling.nextElementSibling;
    }
    return result;
};

/* eslint-disable no-loop-func */

var siblingContainer = function (anchor, container) {
    var parentElements = parents(anchor);
    var containerElement = container;
    var siblingElements;
    var result;

    while (containerElement) {
        siblingElements = siblings(containerElement);

        result = parentElements.reduce(
            function (list, p) { return list.concat(siblingElements.filter(function (s) { return s === p; })); },
            []
        )[0];

        if (result) { break; }

        containerElement = containerElement.parentElement;
    }

    return result;
};

exports.align = align;
exports.addScroll = addScroll;
exports.applyLocationOffset = applyLocationOffset;
exports.boundingOffset = boundingOffset;
exports.isBodyOffset = isBodyOffset;
exports.offsetParent = offsetParent;
exports.offset = offset;
exports.parents = parents;
exports.parentScrollPosition = parentScrollPosition;
exports.position = position;
exports.positionWithScroll = positionWithScroll;
exports.removeScroll = removeScroll;
exports.restrictToView = restrictToView;
exports.scrollPosition = scrollPosition;
exports.siblingContainer = siblingContainer;
exports.siblings = siblings;
exports.getDocumentElement = getDocument;
exports.getWindow = getWindow;
exports.getWindowViewPort = windowViewport;
exports.AlignPoint = alignPoint;
exports.Collision = collision;

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi91c3IvbG9jYWwvamVua2lucy93b3Jrc3BhY2Uva2VuZG8tcG9wdXAtY29tbW9uX3JlbGVhc2Uvc3JjL2FsaWduLXBvaW50LmpzIiwiL3Vzci9sb2NhbC9qZW5raW5zL3dvcmtzcGFjZS9rZW5kby1wb3B1cC1jb21tb25fcmVsZWFzZS9zcmMvYWxpZ24uanMiLCIvdXNyL2xvY2FsL2plbmtpbnMvd29ya3NwYWNlL2tlbmRvLXBvcHVwLWNvbW1vbl9yZWxlYXNlL3NyYy9hZGQtc2Nyb2xsLmpzIiwiL3Vzci9sb2NhbC9qZW5raW5zL3dvcmtzcGFjZS9rZW5kby1wb3B1cC1jb21tb25fcmVsZWFzZS9zcmMvYXBwbHktbG9jYXRpb24tb2Zmc2V0LmpzIiwiL3Vzci9sb2NhbC9qZW5raW5zL3dvcmtzcGFjZS9rZW5kby1wb3B1cC1jb21tb25fcmVsZWFzZS9zcmMvb3duZXItZG9jdW1lbnQuanMiLCIvdXNyL2xvY2FsL2plbmtpbnMvd29ya3NwYWNlL2tlbmRvLXBvcHVwLWNvbW1vbl9yZWxlYXNlL3NyYy93aW5kb3cuanMiLCIvdXNyL2xvY2FsL2plbmtpbnMvd29ya3NwYWNlL2tlbmRvLXBvcHVwLWNvbW1vbl9yZWxlYXNlL3NyYy9kb2N1bWVudC5qcyIsIi91c3IvbG9jYWwvamVua2lucy93b3Jrc3BhY2Uva2VuZG8tcG9wdXAtY29tbW9uX3JlbGVhc2Uvc3JjL3Njcm9sbGJhci13aWR0aC5qcyIsIi91c3IvbG9jYWwvamVua2lucy93b3Jrc3BhY2Uva2VuZG8tcG9wdXAtY29tbW9uX3JlbGVhc2Uvc3JjL3dpbmRvdy12aWV3cG9ydC5qcyIsIi91c3IvbG9jYWwvamVua2lucy93b3Jrc3BhY2Uva2VuZG8tcG9wdXAtY29tbW9uX3JlbGVhc2Uvc3JjL2JvdW5kaW5nLW9mZnNldC5qcyIsIi91c3IvbG9jYWwvamVua2lucy93b3Jrc3BhY2Uva2VuZG8tcG9wdXAtY29tbW9uX3JlbGVhc2Uvc3JjL29mZnNldC1wYXJlbnQuanMiLCIvdXNyL2xvY2FsL2plbmtpbnMvd29ya3NwYWNlL2tlbmRvLXBvcHVwLWNvbW1vbl9yZWxlYXNlL3NyYy9pcy1ib2R5LW9mZnNldC5qcyIsIi91c3IvbG9jYWwvamVua2lucy93b3Jrc3BhY2Uva2VuZG8tcG9wdXAtY29tbW9uX3JlbGVhc2Uvc3JjL29mZnNldC5qcyIsIi91c3IvbG9jYWwvamVua2lucy93b3Jrc3BhY2Uva2VuZG8tcG9wdXAtY29tbW9uX3JlbGVhc2Uvc3JjL3BhcmVudHMuanMiLCIvdXNyL2xvY2FsL2plbmtpbnMvd29ya3NwYWNlL2tlbmRvLXBvcHVwLWNvbW1vbl9yZWxlYXNlL3NyYy9zY3JvbGwtcG9zaXRpb24uanMiLCIvdXNyL2xvY2FsL2plbmtpbnMvd29ya3NwYWNlL2tlbmRvLXBvcHVwLWNvbW1vbl9yZWxlYXNlL3NyYy9lbGVtZW50LXNjcm9sbC1wb3NpdGlvbi5qcyIsIi91c3IvbG9jYWwvamVua2lucy93b3Jrc3BhY2Uva2VuZG8tcG9wdXAtY29tbW9uX3JlbGVhc2Uvc3JjL3BhcmVudC1zY3JvbGwtcG9zaXRpb24uanMiLCIvdXNyL2xvY2FsL2plbmtpbnMvd29ya3NwYWNlL2tlbmRvLXBvcHVwLWNvbW1vbl9yZWxlYXNlL3NyYy9wb3NpdGlvbi5qcyIsIi91c3IvbG9jYWwvamVua2lucy93b3Jrc3BhY2Uva2VuZG8tcG9wdXAtY29tbW9uX3JlbGVhc2Uvc3JjL29mZnNldC1wYXJlbnQtc2Nyb2xsLXBvc2l0aW9uLmpzIiwiL3Vzci9sb2NhbC9qZW5raW5zL3dvcmtzcGFjZS9rZW5kby1wb3B1cC1jb21tb25fcmVsZWFzZS9zcmMvcG9zaXRpb24td2l0aC1zY3JvbGwuanMiLCIvdXNyL2xvY2FsL2plbmtpbnMvd29ya3NwYWNlL2tlbmRvLXBvcHVwLWNvbW1vbl9yZWxlYXNlL3NyYy9yZW1vdmUtc2Nyb2xsLmpzIiwiL3Vzci9sb2NhbC9qZW5raW5zL3dvcmtzcGFjZS9rZW5kby1wb3B1cC1jb21tb25fcmVsZWFzZS9zcmMvY29sbGlzaW9uLmpzIiwiL3Vzci9sb2NhbC9qZW5raW5zL3dvcmtzcGFjZS9rZW5kby1wb3B1cC1jb21tb25fcmVsZWFzZS9zcmMvcmVzdHJpY3QtdG8tdmlldy5qcyIsIi91c3IvbG9jYWwvamVua2lucy93b3Jrc3BhY2Uva2VuZG8tcG9wdXAtY29tbW9uX3JlbGVhc2Uvc3JjL3NpYmxpbmdzLmpzIiwiL3Vzci9sb2NhbC9qZW5raW5zL3dvcmtzcGFjZS9rZW5kby1wb3B1cC1jb21tb25fcmVsZWFzZS9zcmMvc2libGluZy1jb250YWluZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQge1xuICAgIFwiYm90dG9tXCI6IFwiYm90dG9tXCIsXG4gICAgXCJjZW50ZXJcIjogXCJjZW50ZXJcIixcbiAgICBcIm1pZGRsZVwiOiBcIm1pZGRsZVwiLFxuICAgIFwibGVmdFwiOiBcImxlZnRcIixcbiAgICBcInJpZ2h0XCI6IFwicmlnaHRcIixcbiAgICBcInRvcFwiOiBcInRvcFwiXG59O1xuIiwiaW1wb3J0IHBvaW50IGZyb20gJy4vYWxpZ24tcG9pbnQnO1xuXG5jb25zdCBhbGlnbiA9IChvcHRpb25zKSA9PiB7XG4gICAgY29uc3QgeyBhbmNob3JSZWN0LCBhbmNob3JBbGlnbiwgZWxlbWVudFJlY3QsIGVsZW1lbnRBbGlnbiwgbWFyZ2luID0ge30gfSA9IG9wdGlvbnM7XG4gICAgY29uc3QgYW5jaG9ySG9yaXpvbnRhbCA9IGFuY2hvckFsaWduLmhvcml6b250YWw7XG4gICAgY29uc3QgYW5jaG9yVmVydGljYWwgPSBhbmNob3JBbGlnbi52ZXJ0aWNhbDtcbiAgICBjb25zdCBlbGVtZW50SG9yaXpvbnRhbCA9IGVsZW1lbnRBbGlnbi5ob3Jpem9udGFsO1xuICAgIGNvbnN0IGVsZW1lbnRWZXJ0aWNhbCA9IGVsZW1lbnRBbGlnbi52ZXJ0aWNhbDtcblxuICAgIGxldCBob3Jpem9udGFsTWFyZ2luID0gbWFyZ2luLmhvcml6b250YWwgfHwgMDtcbiAgICBsZXQgdmVydGljYWxNYXJnaW4gPSBtYXJnaW4udmVydGljYWwgfHwgMDtcblxuICAgIGxldCB0b3AgPSBhbmNob3JSZWN0LnRvcDtcbiAgICBsZXQgbGVmdCA9IGFuY2hvclJlY3QubGVmdDtcblxuICAgIGlmIChhbmNob3JWZXJ0aWNhbCA9PT0gcG9pbnQuYm90dG9tKSB7XG4gICAgICAgIHRvcCArPSBhbmNob3JSZWN0LmhlaWdodDtcbiAgICB9XG5cbiAgICBpZiAoYW5jaG9yVmVydGljYWwgPT09IHBvaW50LmNlbnRlciB8fCBhbmNob3JWZXJ0aWNhbCA9PT0gcG9pbnQubWlkZGxlKSB7XG4gICAgICAgIHRvcCArPSBNYXRoLnJvdW5kKGFuY2hvclJlY3QuaGVpZ2h0IC8gMik7XG4gICAgfVxuXG4gICAgaWYgKGVsZW1lbnRWZXJ0aWNhbCA9PT0gcG9pbnQuYm90dG9tKSB7XG4gICAgICAgIHRvcCAtPSBlbGVtZW50UmVjdC5oZWlnaHQ7XG4gICAgICAgIHZlcnRpY2FsTWFyZ2luICo9IC0xO1xuICAgIH1cblxuICAgIGlmIChlbGVtZW50VmVydGljYWwgPT09IHBvaW50LmNlbnRlciB8fCBlbGVtZW50VmVydGljYWwgPT09IHBvaW50Lm1pZGRsZSkge1xuICAgICAgICB0b3AgLT0gTWF0aC5yb3VuZChlbGVtZW50UmVjdC5oZWlnaHQgLyAyKTtcbiAgICAgICAgdmVydGljYWxNYXJnaW4gKj0gLTE7XG4gICAgfVxuXG4gICAgaWYgKGFuY2hvckhvcml6b250YWwgPT09IHBvaW50LnJpZ2h0KSB7XG4gICAgICAgIGxlZnQgKz0gYW5jaG9yUmVjdC53aWR0aDtcbiAgICB9XG5cbiAgICBpZiAoYW5jaG9ySG9yaXpvbnRhbCA9PT0gcG9pbnQuY2VudGVyIHx8IGFuY2hvckhvcml6b250YWwgPT09IHBvaW50Lm1pZGRsZSkge1xuICAgICAgICBsZWZ0ICs9IE1hdGgucm91bmQoYW5jaG9yUmVjdC53aWR0aCAvIDIpO1xuICAgIH1cblxuICAgIGlmIChlbGVtZW50SG9yaXpvbnRhbCA9PT0gcG9pbnQucmlnaHQpIHtcbiAgICAgICAgbGVmdCAtPSBlbGVtZW50UmVjdC53aWR0aDtcbiAgICAgICAgaG9yaXpvbnRhbE1hcmdpbiAqPSAtMTtcbiAgICB9XG5cbiAgICBpZiAoZWxlbWVudEhvcml6b250YWwgPT09IHBvaW50LmNlbnRlciB8fCBlbGVtZW50SG9yaXpvbnRhbCA9PT0gcG9pbnQubWlkZGxlKSB7XG4gICAgICAgIGxlZnQgLT0gTWF0aC5yb3VuZChlbGVtZW50UmVjdC53aWR0aCAvIDIpO1xuICAgICAgICBob3Jpem9udGFsTWFyZ2luICo9IC0xO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHRvcDogdG9wICsgdmVydGljYWxNYXJnaW4sXG4gICAgICAgIGxlZnQ6IGxlZnQgKyBob3Jpem9udGFsTWFyZ2luXG4gICAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGFsaWduO1xuIiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYWRkU2Nyb2xsKHJlY3QsIHNjcm9sbCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHRvcDogcmVjdC50b3AgKyBzY3JvbGwueSxcbiAgICAgICAgbGVmdDogcmVjdC5sZWZ0ICsgc2Nyb2xsLngsXG4gICAgICAgIGhlaWdodDogcmVjdC5oZWlnaHQsXG4gICAgICAgIHdpZHRoOiByZWN0LndpZHRoXG4gICAgfTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGFwcGx5TG9jYXRpb25PZmZzZXQocmVjdCwgbG9jYXRpb24sIGlzT2Zmc2V0Qm9keSkge1xuICAgIGxldCB7IHRvcCwgbGVmdCB9ID0gcmVjdDtcblxuICAgIGlmIChpc09mZnNldEJvZHkpIHtcbiAgICAgICAgbGVmdCA9IDA7XG4gICAgICAgIHRvcCA9IDA7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgdG9wOiB0b3AgKyBsb2NhdGlvbi50b3AsXG4gICAgICAgIGxlZnQ6IGxlZnQgKyBsb2NhdGlvbi5sZWZ0LFxuICAgICAgICBoZWlnaHQ6IHJlY3QuaGVpZ2h0LFxuICAgICAgICB3aWR0aDogcmVjdC53aWR0aFxuICAgIH07XG59XG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBvd25lckRvY3VtZW50KGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5vd25lckRvY3VtZW50IHx8IGVsZW1lbnQuZG9jdW1lbnQgfHwgZWxlbWVudDtcbn1cbiIsImltcG9ydCBvd25lckRvY3VtZW50IGZyb20gJy4vb3duZXItZG9jdW1lbnQnO1xuXG5jb25zdCBnZXRXaW5kb3cgPSAoZWxlbWVudCkgPT4gb3duZXJEb2N1bWVudChlbGVtZW50KS5kZWZhdWx0VmlldztcblxuZXhwb3J0IGRlZmF1bHQgZ2V0V2luZG93O1xuIiwiaW1wb3J0IG93bmVyRG9jdW1lbnQgZnJvbSAnLi9vd25lci1kb2N1bWVudCc7XG5cbmNvbnN0IGdldERvY3VtZW50ID0gKGVsZW1lbnQpID0+IG93bmVyRG9jdW1lbnQoZWxlbWVudCkuZG9jdW1lbnRFbGVtZW50O1xuXG5leHBvcnQgZGVmYXVsdCBnZXREb2N1bWVudDtcbiIsImxldCBjYWNoZWRXaWR0aCA9IDA7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHNjcm9sbGJhcldpZHRoKCkge1xuICAgIGlmICghY2FjaGVkV2lkdGggJiYgdHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuXG4gICAgICAgIGRpdi5zdHlsZS5jc3NUZXh0ID0gXCJvdmVyZmxvdzpzY3JvbGw7b3ZlcmZsb3cteDpoaWRkZW47em9vbToxO2NsZWFyOmJvdGg7ZGlzcGxheTpibG9ja1wiO1xuICAgICAgICBkaXYuaW5uZXJIVE1MID0gXCImbmJzcDtcIjtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkaXYpO1xuXG4gICAgICAgIGNhY2hlZFdpZHRoID0gZGl2Lm9mZnNldFdpZHRoIC0gZGl2LnNjcm9sbFdpZHRoO1xuXG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZGl2KTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2FjaGVkV2lkdGg7XG59XG4iLCJpbXBvcnQgd25kIGZyb20gJy4vd2luZG93JztcbmltcG9ydCBnZXREb2N1bWVudCBmcm9tICcuL2RvY3VtZW50JztcbmltcG9ydCBzY3JvbGxiYXJXaWR0aCBmcm9tICcuL3Njcm9sbGJhci13aWR0aCc7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHdpbmRvd1ZpZXdwb3J0KGVsZW1lbnQpIHtcbiAgICBjb25zdCB3aW4gPSB3bmQoZWxlbWVudCk7XG4gICAgY29uc3QgZG9jdW1lbnQgPSBnZXREb2N1bWVudChlbGVtZW50KTtcbiAgICBjb25zdCByZXN1bHQgPSB7XG4gICAgICAgIGhlaWdodDogd2luLmlubmVySGVpZ2h0LFxuICAgICAgICB3aWR0aDogd2luLmlubmVyV2lkdGhcbiAgICB9O1xuXG4gICAgaWYgKGRvY3VtZW50LnNjcm9sbEhlaWdodCAtIGRvY3VtZW50LmNsaWVudEhlaWdodCA+IDApIHtcbiAgICAgICAgcmVzdWx0LndpZHRoIC09IHNjcm9sbGJhcldpZHRoKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbiIsImltcG9ydCB3aW5kb3dWaWV3cG9ydCBmcm9tICcuL3dpbmRvdy12aWV3cG9ydCc7XG5cbmNvbnN0IGJvdW5kaW5nT2Zmc2V0ID0gKGVsZW1lbnQpID0+IHtcbiAgICBpZiAoIWVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KSB7XG4gICAgICAgIGNvbnN0IHZpZXdwb3J0ID0gd2luZG93Vmlld3BvcnQoZWxlbWVudCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib3R0b206IHZpZXdwb3J0LmhlaWdodCxcbiAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICByaWdodDogdmlld3BvcnQud2lkdGgsXG4gICAgICAgICAgICB0b3A6IDBcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGJvdHRvbSwgbGVmdCwgcmlnaHQsIHRvcCB9ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGJvdHRvbSxcbiAgICAgICAgbGVmdCxcbiAgICAgICAgcmlnaHQsXG4gICAgICAgIHRvcFxuICAgIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBib3VuZGluZ09mZnNldDtcbiIsImltcG9ydCBkb2N1bWVudEVsZW1lbnQgZnJvbSAnLi9kb2N1bWVudCc7XG5cbmNvbnN0IG9mZnNldFBhcmVudCA9IChlbGVtZW50KSA9PiB7XG4gICAgbGV0IG9mZnNldFBhcmVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50O1xuXG4gICAgd2hpbGUgKG9mZnNldFBhcmVudCAmJiBvZmZzZXRQYXJlbnQuc3R5bGUucG9zaXRpb24gPT09IFwic3RhdGljXCIpIHtcbiAgICAgICAgb2Zmc2V0UGFyZW50ID0gb2Zmc2V0UGFyZW50Lm9mZnNldFBhcmVudDtcbiAgICB9XG5cbiAgICByZXR1cm4gb2Zmc2V0UGFyZW50IHx8IGRvY3VtZW50RWxlbWVudChlbGVtZW50KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IG9mZnNldFBhcmVudDtcbiIsImltcG9ydCBvZmZzZXRQYXJlbnQgZnJvbSAnLi9vZmZzZXQtcGFyZW50JztcblxuY29uc3QgaXNCb2R5T2Zmc2V0ID0gKGVsZW1lbnQpID0+IChvZmZzZXRQYXJlbnQoZWxlbWVudCkgPT09IGVsZW1lbnQub3duZXJEb2N1bWVudC5ib2R5KTtcblxuZXhwb3J0IGRlZmF1bHQgaXNCb2R5T2Zmc2V0O1xuIiwiY29uc3QgcmVjdE9mSGlkZGVuRWxlbWVudCA9IChlbGVtZW50KSA9PiB7XG4gICAgY29uc3QgeyBkaXNwbGF5LCBsZWZ0LCBwb3NpdGlvbiB9ID0gZWxlbWVudC5zdHlsZTtcblxuICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICcnO1xuICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9ICctMTAwMDBweCc7XG4gICAgZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG5cbiAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7XG4gICAgZWxlbWVudC5zdHlsZS5sZWZ0ID0gbGVmdDtcbiAgICBlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gcG9zaXRpb247XG5cbiAgICByZXR1cm4gcmVjdDtcbn07XG5cbmNvbnN0IG9mZnNldCA9IChlbGVtZW50KSA9PiB7XG4gICAgbGV0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGxldCB7IGxlZnQsIHRvcCB9ID0gcmVjdDtcblxuICAgIGlmICghcmVjdC5oZWlnaHQgJiYgIXJlY3Qud2lkdGgpIHtcbiAgICAgICAgcmVjdCA9IHJlY3RPZkhpZGRlbkVsZW1lbnQoZWxlbWVudCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgdG9wOiB0b3AsXG4gICAgICAgIGxlZnQ6IGxlZnQsXG4gICAgICAgIGhlaWdodDogcmVjdC5oZWlnaHQsXG4gICAgICAgIHdpZHRoOiByZWN0LndpZHRoXG4gICAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IG9mZnNldDtcbiIsImV4cG9ydCBkZWZhdWx0IChlbGVtZW50LCB1bnRpbCkgPT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgIGxldCBuZXh0ID0gZWxlbWVudC5wYXJlbnROb2RlO1xuXG4gICAgd2hpbGUgKG5leHQpIHtcbiAgICAgICAgcmVzdWx0LnB1c2gobmV4dCk7XG5cbiAgICAgICAgaWYgKG5leHQgPT09IHVudGlsKSB7IGJyZWFrOyB9XG5cbiAgICAgICAgbmV4dCA9IG5leHQucGFyZW50Tm9kZTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbiIsImltcG9ydCBkb2NFbGVtZW50IGZyb20gJy4vZG9jdW1lbnQnO1xuaW1wb3J0IHduZCBmcm9tICcuL3dpbmRvdyc7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHNjcm9sbFBvc2l0aW9uKGVsZW1lbnQpIHtcbiAgICBjb25zdCBkb2N1bWVudEVsZW1lbnQgPSBkb2NFbGVtZW50KGVsZW1lbnQpO1xuICAgIGNvbnN0IHdpbiA9IHduZChlbGVtZW50KTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHg6IHdpbi5wYWdlWE9mZnNldCB8fCBkb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCB8fCAwLFxuICAgICAgICB5OiB3aW4ucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCAwXG4gICAgfTtcbn1cbiIsImltcG9ydCBzY3JvbGxQb3NpdGlvbiBmcm9tICcuL3Njcm9sbC1wb3NpdGlvbic7XG5cbmV4cG9ydCBkZWZhdWx0IChlbGVtZW50KSA9PiB7XG4gICAgaWYgKGVsZW1lbnQgPT09IChlbGVtZW50Lm93bmVyRG9jdW1lbnQgfHwge30pLmJvZHkpIHtcbiAgICAgICAgcmV0dXJuIHNjcm9sbFBvc2l0aW9uKGVsZW1lbnQpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHg6IGVsZW1lbnQuc2Nyb2xsTGVmdCxcbiAgICAgICAgeTogZWxlbWVudC5zY3JvbGxUb3BcbiAgICB9O1xufTtcbiIsImltcG9ydCBvZmZzZXRQYXJlbnQgZnJvbSAnLi9vZmZzZXQtcGFyZW50JztcbmltcG9ydCBlbGVtZW50U2Nyb2xsUG9zaXRpb24gZnJvbSAnLi9lbGVtZW50LXNjcm9sbC1wb3NpdGlvbic7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHBhcmVudFNjcm9sbFBvc2l0aW9uKGVsZW1lbnQpIHtcbiAgICBjb25zdCBwYXJlbnQgPSBvZmZzZXRQYXJlbnQoZWxlbWVudCk7XG5cbiAgICByZXR1cm4gcGFyZW50ID8gZWxlbWVudFNjcm9sbFBvc2l0aW9uKHBhcmVudCkgOiB7IHg6IDAsIHk6IDAgfTtcbn1cbiIsImltcG9ydCBvZmZzZXRQYXJlbnQgZnJvbSAnLi9vZmZzZXQtcGFyZW50JztcbmltcG9ydCBvZmZzZXRSZWN0IGZyb20gJy4vb2Zmc2V0JztcbmltcG9ydCB3bmQgZnJvbSAnLi93aW5kb3cnO1xuXG5jb25zdCBwb3NpdGlvbiA9IChlbGVtZW50LCBwYXJlbnQpID0+IHtcbiAgICBjb25zdCB3aW4gPSB3bmQoZWxlbWVudCk7XG4gICAgY29uc3QgZWxlbWVudFN0eWxlcyA9IHdpbi5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpO1xuICAgIGNvbnN0IG9mZnNldCA9IG9mZnNldFJlY3QoZWxlbWVudCk7XG4gICAgY29uc3QgcGFyZW50RWxlbWVudCA9IHBhcmVudCB8fCBvZmZzZXRQYXJlbnQoZWxlbWVudCk7XG5cbiAgICBjb25zdCBvd25lckRvY3VtZW50ID0gZWxlbWVudC5vd25lckRvY3VtZW50O1xuICAgIGNvbnN0IHVzZVJlbGF0aXZlID0gcGFyZW50RWxlbWVudCAhPT0gb3duZXJEb2N1bWVudC5ib2R5ICYmIHBhcmVudEVsZW1lbnQgIT09IG93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuXG4gICAgbGV0IHBhcmVudE9mZnNldCA9IHsgdG9wOiAwLCBsZWZ0OiAwIH07XG5cbiAgICBpZiAoZWxlbWVudFN0eWxlcy5wb3NpdGlvbiAhPT0gXCJmaXhlZFwiICYmIHVzZVJlbGF0aXZlKSB7XG4gICAgICAgIGNvbnN0IHBhcmVudFN0eWxlcyA9IHdpbi5nZXRDb21wdXRlZFN0eWxlKHBhcmVudEVsZW1lbnQpO1xuXG4gICAgICAgIHBhcmVudE9mZnNldCA9IG9mZnNldFJlY3QocGFyZW50RWxlbWVudCk7XG4gICAgICAgIHBhcmVudE9mZnNldC50b3AgKz0gcGFyc2VJbnQocGFyZW50U3R5bGVzLmJvcmRlclRvcFdpZHRoLCAxMCk7XG4gICAgICAgIHBhcmVudE9mZnNldC5sZWZ0ICs9IHBhcnNlSW50KHBhcmVudFN0eWxlcy5ib3JkZXJMZWZ0V2lkdGgsIDEwKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICB0b3A6IG9mZnNldC50b3AgLSBwYXJlbnRPZmZzZXQudG9wLFxuICAgICAgICBsZWZ0OiBvZmZzZXQubGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0LFxuICAgICAgICBoZWlnaHQ6IG9mZnNldC5oZWlnaHQsXG4gICAgICAgIHdpZHRoOiBvZmZzZXQud2lkdGhcbiAgICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgcG9zaXRpb247XG4iLCJpbXBvcnQgZWxlbWVudFNjcm9sbFBvc2l0aW9uIGZyb20gJy4vZWxlbWVudC1zY3JvbGwtcG9zaXRpb24nO1xuaW1wb3J0IHBhcmVudFNjcm9sbFBvc2l0aW9uIGZyb20gJy4vcGFyZW50LXNjcm9sbC1wb3NpdGlvbic7XG5cbmV4cG9ydCBkZWZhdWx0IChvZmZzZXRQYXJlbnRFbGVtZW50LCBlbGVtZW50KSA9PiAoIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tYXJyb3ctY29uZGl0aW9uXG4gICAgb2Zmc2V0UGFyZW50RWxlbWVudCA/IGVsZW1lbnRTY3JvbGxQb3NpdGlvbihvZmZzZXRQYXJlbnRFbGVtZW50KSA6IHBhcmVudFNjcm9sbFBvc2l0aW9uKGVsZW1lbnQpXG4pO1xuIiwiaW1wb3J0IG9mZnNldFBhcmVudFNjcm9sbFBvc2l0aW9uIGZyb20gJy4vb2Zmc2V0LXBhcmVudC1zY3JvbGwtcG9zaXRpb24nO1xuaW1wb3J0IG9mZnNldFBhcmVudCBmcm9tICcuL29mZnNldC1wYXJlbnQnO1xuaW1wb3J0IHBvc2l0aW9uIGZyb20gJy4vcG9zaXRpb24nO1xuXG5leHBvcnQgZGVmYXVsdCAoZWxlbWVudCwgcGFyZW50KSA9PiB7XG4gICAgY29uc3Qgb2Zmc2V0UGFyZW50RWxlbWVudCA9IHBhcmVudCA/IG9mZnNldFBhcmVudChwYXJlbnQpIDogbnVsbDtcbiAgICBjb25zdCB7IHRvcCwgbGVmdCwgaGVpZ2h0LCB3aWR0aCB9ID0gcG9zaXRpb24oZWxlbWVudCwgb2Zmc2V0UGFyZW50RWxlbWVudCk7XG4gICAgY29uc3QgeyB4LCB5IH0gPSBvZmZzZXRQYXJlbnRTY3JvbGxQb3NpdGlvbihvZmZzZXRQYXJlbnRFbGVtZW50LCBlbGVtZW50KTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHRvcDogdG9wICsgeSxcbiAgICAgICAgbGVmdDogbGVmdCArIHgsXG4gICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICB3aWR0aDogd2lkdGhcbiAgICB9O1xufTtcbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlbW92ZVNjcm9sbChyZWN0LCBzY3JvbGwpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0b3A6IHJlY3QudG9wIC0gc2Nyb2xsLnksXG4gICAgICAgIGxlZnQ6IHJlY3QubGVmdCAtIHNjcm9sbC54LFxuICAgICAgICBoZWlnaHQ6IHJlY3QuaGVpZ2h0LFxuICAgICAgICB3aWR0aDogcmVjdC53aWR0aFxuICAgIH07XG59XG4iLCJleHBvcnQgZGVmYXVsdCB7XG4gICAgXCJmaXRcIjogXCJmaXRcIixcbiAgICBcImZsaXBcIjogXCJmbGlwXCJcbn07XG4iLCJpbXBvcnQgYWxpZ25Qb2ludCBmcm9tICcuL2FsaWduLXBvaW50JztcbmltcG9ydCBjb2xsaXNpb24gZnJvbSAnLi9jb2xsaXNpb24nO1xuXG5jb25zdCBmaXQgPSBmdW5jdGlvbihwb3NpdGlvbiwgc2l6ZSwgdmlld1BvcnRTaXplKSB7XG4gICAgbGV0IG91dHB1dCA9IDA7XG5cbiAgICBpZiAocG9zaXRpb24gKyBzaXplID4gdmlld1BvcnRTaXplKSB7XG4gICAgICAgIG91dHB1dCA9IHZpZXdQb3J0U2l6ZSAtIChwb3NpdGlvbiArIHNpemUpO1xuICAgIH1cblxuICAgIGlmIChwb3NpdGlvbiA8IDApIHtcbiAgICAgICAgb3V0cHV0ID0gLXBvc2l0aW9uO1xuICAgIH1cblxuICAgIHJldHVybiBvdXRwdXQ7XG59O1xuXG5jb25zdCBmbGlwID0gZnVuY3Rpb24oeyBvZmZzZXQsIHNpemUsIGFuY2hvclNpemUsIHZpZXdQb3J0U2l6ZSwgYW5jaG9yQWxpZ25Qb2ludCwgZWxlbWVudEFsaWduUG9pbnQsIG1hcmdpbiB9KSB7XG4gICAgbGV0IG91dHB1dCA9IDA7XG5cbiAgICBjb25zdCBpc1Bvc2l0aW9uQ2VudGVyZWQgPSBlbGVtZW50QWxpZ25Qb2ludCA9PT0gYWxpZ25Qb2ludC5jZW50ZXIgfHwgZWxlbWVudEFsaWduUG9pbnQgPT09IGFsaWduUG9pbnQubWlkZGxlO1xuICAgIGNvbnN0IGlzT3JpZ2luQ2VudGVyZWQgPSBhbmNob3JBbGlnblBvaW50ID09PSBhbGlnblBvaW50LmNlbnRlciB8fCBhbmNob3JBbGlnblBvaW50ID09PSBhbGlnblBvaW50Lm1pZGRsZTtcbiAgICBjb25zdCBtYXJnaW5Ub0FkZCA9IDIgKiBtYXJnaW47IC8vMnggdG8ga2VlcCBtYXJnaW4gYWZ0ZXIgZmxpcFxuXG4gICAgaWYgKGVsZW1lbnRBbGlnblBvaW50ICE9PSBhbmNob3JBbGlnblBvaW50ICYmICFpc1Bvc2l0aW9uQ2VudGVyZWQgJiYgIWlzT3JpZ2luQ2VudGVyZWQpIHtcbiAgICAgICAgY29uc3QgaXNCZWZvcmVBbmNob3IgPSBhbmNob3JBbGlnblBvaW50ID09PSBhbGlnblBvaW50LnRvcCB8fCBhbmNob3JBbGlnblBvaW50ID09PSBhbGlnblBvaW50LmxlZnQ7XG4gICAgICAgIGlmIChvZmZzZXQgPCAwICYmIGlzQmVmb3JlQW5jaG9yKSB7XG4gICAgICAgICAgICBvdXRwdXQgPSBzaXplICsgYW5jaG9yU2l6ZSArIG1hcmdpblRvQWRkO1xuICAgICAgICAgICAgaWYgKG9mZnNldCArIG91dHB1dCArIHNpemUgPiB2aWV3UG9ydFNpemUpIHtcbiAgICAgICAgICAgICAgICBvdXRwdXQgPSAwOyAvL3NraXAgZmxpcFxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG9mZnNldCA+PSAwICYmICFpc0JlZm9yZUFuY2hvcikge1xuICAgICAgICAgICAgaWYgKG9mZnNldCArIHNpemUgPiB2aWV3UG9ydFNpemUpIHtcbiAgICAgICAgICAgICAgICBvdXRwdXQgKz0gLShhbmNob3JTaXplICsgc2l6ZSArIG1hcmdpblRvQWRkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG9mZnNldCArIG91dHB1dCA8IDApIHtcbiAgICAgICAgICAgICAgICBvdXRwdXQgPSAwOyAvL3NraXAgZmxpcFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG91dHB1dDtcbn07XG5cbmNvbnN0IHJlc3RyaWN0VG9WaWV3ID0gKG9wdGlvbnMpID0+IHtcbiAgICBjb25zdCB7IGFuY2hvclJlY3QsIGFuY2hvckFsaWduLCBlbGVtZW50UmVjdCwgZWxlbWVudEFsaWduLCBjb2xsaXNpb25zLCB2aWV3UG9ydCwgbWFyZ2luID0ge30gfSA9IG9wdGlvbnM7XG4gICAgY29uc3QgeyB0b3A6IGVsZW1lbnRUb3AsIGxlZnQ6IGVsZW1lbnRMZWZ0LCBoZWlnaHQ6IGVsZW1lbnRIZWlnaHQsIHdpZHRoOiBlbGVtZW50V2lkdGggfSA9IGVsZW1lbnRSZWN0O1xuICAgIGNvbnN0IHsgaGVpZ2h0OiB2aWV3UG9ydEhlaWdodCwgd2lkdGg6IHZpZXdQb3J0V2lkdGggfSA9IHZpZXdQb3J0O1xuICAgIGNvbnN0IGhvcml6b250YWxNYXJnaW4gPSBtYXJnaW4uaG9yaXpvbnRhbCB8fCAwO1xuICAgIGNvbnN0IHZlcnRpY2FsTWFyZ2luID0gbWFyZ2luLnZlcnRpY2FsIHx8IDA7XG5cbiAgICBsZXQgbGVmdCA9IDA7XG4gICAgbGV0IHRvcCA9IDA7XG5cbiAgICBjb25zdCBpc0hvcml6b250YWxGbGlwID0gY29sbGlzaW9ucy5ob3Jpem9udGFsID09PSBjb2xsaXNpb24uZmxpcDtcbiAgICBjb25zdCBpc1ZlcnRpY2FsRmxpcCA9IGNvbGxpc2lvbnMudmVydGljYWwgPT09IGNvbGxpc2lvbi5mbGlwO1xuXG4gICAgaWYgKGNvbGxpc2lvbnMudmVydGljYWwgPT09IGNvbGxpc2lvbi5maXQpIHtcbiAgICAgICAgdG9wICs9IGZpdChlbGVtZW50VG9wLCBlbGVtZW50SGVpZ2h0LCB2aWV3UG9ydEhlaWdodCk7XG4gICAgfVxuXG4gICAgaWYgKGNvbGxpc2lvbnMuaG9yaXpvbnRhbCA9PT0gY29sbGlzaW9uLmZpdCkge1xuICAgICAgICBsZWZ0ICs9IGZpdChlbGVtZW50TGVmdCwgZWxlbWVudFdpZHRoLCB2aWV3UG9ydFdpZHRoKTtcbiAgICB9XG5cbiAgICBpZiAoaXNWZXJ0aWNhbEZsaXApIHtcbiAgICAgICAgdG9wICs9IGZsaXAoe1xuICAgICAgICAgICAgbWFyZ2luOiB2ZXJ0aWNhbE1hcmdpbixcbiAgICAgICAgICAgIG9mZnNldDogZWxlbWVudFRvcCxcbiAgICAgICAgICAgIHNpemU6IGVsZW1lbnRIZWlnaHQsXG4gICAgICAgICAgICBhbmNob3JTaXplOiBhbmNob3JSZWN0LmhlaWdodCxcbiAgICAgICAgICAgIHZpZXdQb3J0U2l6ZTogdmlld1BvcnRIZWlnaHQsXG4gICAgICAgICAgICBhbmNob3JBbGlnblBvaW50OiBhbmNob3JBbGlnbi52ZXJ0aWNhbCxcbiAgICAgICAgICAgIGVsZW1lbnRBbGlnblBvaW50OiBlbGVtZW50QWxpZ24udmVydGljYWxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGlzSG9yaXpvbnRhbEZsaXApIHtcbiAgICAgICAgbGVmdCArPSBmbGlwKHtcbiAgICAgICAgICAgIG1hcmdpbjogaG9yaXpvbnRhbE1hcmdpbixcbiAgICAgICAgICAgIG9mZnNldDogZWxlbWVudExlZnQsXG4gICAgICAgICAgICBzaXplOiBlbGVtZW50V2lkdGgsXG4gICAgICAgICAgICBhbmNob3JTaXplOiBhbmNob3JSZWN0LndpZHRoLFxuICAgICAgICAgICAgdmlld1BvcnRTaXplOiB2aWV3UG9ydFdpZHRoLFxuICAgICAgICAgICAgYW5jaG9yQWxpZ25Qb2ludDogYW5jaG9yQWxpZ24uaG9yaXpvbnRhbCxcbiAgICAgICAgICAgIGVsZW1lbnRBbGlnblBvaW50OiBlbGVtZW50QWxpZ24uaG9yaXpvbnRhbFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgZmxpcHBlZEhvcml6b250YWwgPSBpc0hvcml6b250YWxGbGlwICYmIGxlZnQgIT09IDA7XG4gICAgY29uc3QgZmxpcHBlZFZlcnRpY2FsID0gaXNWZXJ0aWNhbEZsaXAgJiYgdG9wICE9PSAwO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZmxpcHBlZDogZmxpcHBlZEhvcml6b250YWwgfHwgZmxpcHBlZFZlcnRpY2FsLFxuICAgICAgICBmbGlwOiB7XG4gICAgICAgICAgICBob3Jpem9udGFsOiBmbGlwcGVkSG9yaXpvbnRhbCxcbiAgICAgICAgICAgIHZlcnRpY2FsOiBmbGlwcGVkVmVydGljYWxcbiAgICAgICAgfSxcbiAgICAgICAgb2Zmc2V0OiB7XG4gICAgICAgICAgICBsZWZ0OiBsZWZ0LFxuICAgICAgICAgICAgdG9wOiB0b3BcbiAgICAgICAgfVxuICAgIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCByZXN0cmljdFRvVmlldztcbiIsImV4cG9ydCBkZWZhdWx0IChlbGVtZW50KSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gW107XG5cbiAgICBsZXQgc2libGluZyA9IGVsZW1lbnQucGFyZW50Tm9kZS5maXJzdEVsZW1lbnRDaGlsZDtcblxuICAgIHdoaWxlIChzaWJsaW5nKSB7XG4gICAgICAgIGlmIChzaWJsaW5nICE9PSBlbGVtZW50KSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChzaWJsaW5nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNpYmxpbmcgPSBzaWJsaW5nLm5leHRFbGVtZW50U2libGluZztcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG4iLCIvKiBlc2xpbnQtZGlzYWJsZSBuby1sb29wLWZ1bmMgKi9cblxuaW1wb3J0IHBhcmVudHMgZnJvbSAnLi9wYXJlbnRzJztcbmltcG9ydCBzaWJsaW5ncyBmcm9tICcuL3NpYmxpbmdzJztcblxuZXhwb3J0IGRlZmF1bHQgKGFuY2hvciwgY29udGFpbmVyKSA9PiB7XG4gICAgY29uc3QgcGFyZW50RWxlbWVudHMgPSBwYXJlbnRzKGFuY2hvcik7XG4gICAgbGV0IGNvbnRhaW5lckVsZW1lbnQgPSBjb250YWluZXI7XG4gICAgbGV0IHNpYmxpbmdFbGVtZW50cztcbiAgICBsZXQgcmVzdWx0O1xuXG4gICAgd2hpbGUgKGNvbnRhaW5lckVsZW1lbnQpIHtcbiAgICAgICAgc2libGluZ0VsZW1lbnRzID0gc2libGluZ3MoY29udGFpbmVyRWxlbWVudCk7XG5cbiAgICAgICAgcmVzdWx0ID0gcGFyZW50RWxlbWVudHMucmVkdWNlKFxuICAgICAgICAgICAgKGxpc3QsIHApID0+IGxpc3QuY29uY2F0KHNpYmxpbmdFbGVtZW50cy5maWx0ZXIocyA9PiBzID09PSBwKSksXG4gICAgICAgICAgICBbXVxuICAgICAgICApWzBdO1xuXG4gICAgICAgIGlmIChyZXN1bHQpIHsgYnJlYWs7IH1cblxuICAgICAgICBjb250YWluZXJFbGVtZW50ID0gY29udGFpbmVyRWxlbWVudC5wYXJlbnRFbGVtZW50O1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG4iXSwibmFtZXMiOlsiY29uc3QiLCJsZXQiLCJwb2ludCIsInduZCIsImRvY3VtZW50RWxlbWVudCIsImRvY0VsZW1lbnQiLCJvZmZzZXQiLCJvZmZzZXRSZWN0Il0sIm1hcHBpbmdzIjoiOzs7O0FBQUEsaUJBQWU7SUFDWCxRQUFRLEVBQUUsUUFBUTtJQUNsQixRQUFRLEVBQUUsUUFBUTtJQUNsQixRQUFRLEVBQUUsUUFBUTtJQUNsQixNQUFNLEVBQUUsTUFBTTtJQUNkLE9BQU8sRUFBRSxPQUFPO0lBQ2hCLEtBQUssRUFBRSxLQUFLO0NBQ2YsQ0FBQzs7QUNMRkEsSUFBTSxLQUFLLEdBQUcsVUFBQyxPQUFPLEVBQUU7SUFDcEIsSUFBUSxVQUFVO0lBQUUsSUFBQSxXQUFXO0lBQUUsSUFBQSxXQUFXO0lBQUUsSUFBQSxZQUFZO0lBQVcsK0RBQUEsRUFBRSxDQUFqRTtJQUNOQSxJQUFNLGdCQUFnQixHQUFHLFdBQVcsQ0FBQyxVQUFVLENBQUM7SUFDaERBLElBQU0sY0FBYyxHQUFHLFdBQVcsQ0FBQyxRQUFRLENB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